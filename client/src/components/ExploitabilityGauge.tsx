interface ExploitabilityGaugeProps {
  score: number;
  confidence: number;
  size?: "sm" | "md" | "lg";
}

export function ExploitabilityGauge({ score, confidence, size = "md" }: ExploitabilityGaugeProps) {
  const getRiskLevel = (score: number) => {
    if (score >= 80) return { level: "Critical", color: "text-red-400", bgColor: "stroke-red-500" };
    if (score >= 60) return { level: "High", color: "text-orange-400", bgColor: "stroke-orange-500" };
    if (score >= 40) return { level: "Medium", color: "text-amber-400", bgColor: "stroke-amber-500" };
    if (score >= 20) return { level: "Low", color: "text-emerald-400", bgColor: "stroke-emerald-500" };
    return { level: "Minimal", color: "text-cyan-400", bgColor: "stroke-cyan-500" };
  };

  const risk = getRiskLevel(score);
  const dimensions = {
    sm: { width: 120, strokeWidth: 8, fontSize: "text-2xl" },
    md: { width: 160, strokeWidth: 10, fontSize: "text-3xl" },
    lg: { width: 200, strokeWidth: 12, fontSize: "text-4xl" },
  };
  
  const { width, strokeWidth, fontSize } = dimensions[size];
  const radius = (width - strokeWidth) / 2;
  const circumference = Math.PI * radius;
  const strokeDashoffset = circumference - (score / 100) * circumference;

  return (
    <div className="flex flex-col items-center" data-testid="exploitability-gauge">
      <div className="relative" style={{ width, height: width / 2 + 20 }}>
        <svg
          width={width}
          height={width / 2 + 10}
          viewBox={`0 0 ${width} ${width / 2 + 10}`}
          className="transform rotate-0"
        >
          <path
            d={`M ${strokeWidth / 2} ${width / 2} A ${radius} ${radius} 0 0 1 ${width - strokeWidth / 2} ${width / 2}`}
            fill="none"
            stroke="currentColor"
            strokeWidth={strokeWidth}
            className="text-muted/30"
          />
          <path
            d={`M ${strokeWidth / 2} ${width / 2} A ${radius} ${radius} 0 0 1 ${width - strokeWidth / 2} ${width / 2}`}
            fill="none"
            strokeWidth={strokeWidth}
            strokeLinecap="round"
            className={risk.bgColor}
            style={{
              strokeDasharray: circumference,
              strokeDashoffset: strokeDashoffset,
              transition: "stroke-dashoffset 1s ease-out",
            }}
          />
        </svg>
        <div className="absolute inset-0 flex flex-col items-center justify-end pb-0">
          <span className={`${fontSize} font-bold tabular-nums ${risk.color}`}>{score}</span>
        </div>
      </div>
      
      <div className="text-center mt-2">
        <span className={`text-sm font-semibold ${risk.color}`}>{risk.level} Risk</span>
      </div>

      <div className="w-full mt-4">
        <div className="flex justify-between text-xs text-muted-foreground mb-1">
          <span>AI Confidence</span>
          <span className="font-mono">{Math.round(confidence * 100)}%</span>
        </div>
        <div className="h-2 bg-muted rounded-full overflow-hidden">
          <div 
            className="h-full bg-gradient-to-r from-cyan-500 to-blue-500 transition-all duration-500"
            style={{ width: `${confidence * 100}%` }}
          />
        </div>
      </div>
    </div>
  );
}
